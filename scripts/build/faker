#!/usr/bin/env bash

# Do not use this script manually, Use makefile
set -eu -o pipefail

source ./scripts/.variables

export GOOS=linux
export GOARCH=amd64
TARGET="binaries/monitoror-$GOOS-$GOARCH-faker"

export LDFLAGS="\
    -w \
    -X \"github.com/monitoror/monitoror/cli/version.GitCommit=${GITCOMMIT}\" \
    -X \"github.com/monitoror/monitoror/cli/version.BuildTime=${BUILDTIME}\" \
    -X \"github.com/monitoror/monitoror/cli/version.Version=faker\" \
    ${LDFLAGS:-} \
"

export CGO_ENABLED=0
export GOGC=off

echo "Building statically linked $TARGET"
go build -o "${TARGET}" --ldflags "${LDFLAGS}" -tags faker "${SOURCE}"
